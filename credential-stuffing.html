<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Credential Stuffing Demonstrator | Bassaleg CS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');
        .font-mono { font-family: 'JetBrains Mono', monospace; }

        @keyframes pulse-amber {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .animate-probe { animation: pulse-amber 1s ease-in-out infinite; }
    </style>
</head>
<body class="bg-slate-900 text-slate-200 min-h-screen font-sans flex flex-col items-center justify-center p-4">

    <main class="w-full max-w-5xl bg-slate-800 rounded-xl shadow-2xl overflow-hidden border border-slate-700">
        <header class="bg-indigo-600 p-6 text-center">
            <h1 class="text-3xl font-bold text-white">Credential Stuffing Demonstrator</h1>
            <p class="text-indigo-200 mt-2 text-sm">Showing how re-used passwords unlock multiple sites</p>
        </header>

        <div class="p-8 space-y-6">
            <section class="bg-slate-700/50 p-4 rounded-lg border-l-4 border-indigo-500" aria-label="How it works">
                <h2 class="text-lg font-semibold text-white mb-2">How it works</h2>
                <p class="text-slate-300 text-sm">
                    This demo pretends to load an exposed credential list, then automatically replays those usernames and
                    passwords against several popular service types. Watch the table update with results to illustrate how
                    re-used passwords can unlock many accounts. One victim below only has <strong>one</strong> successful login – a cue to discuss password managers. You can also visit <a href="https://haveibeenpwned.com/" class="text-indigo-300 hover:text-indigo-200 underline underline-offset-2" target="_blank" rel="noopener noreferrer">Have I Been Pwned</a> to check if an email has appeared in a breach.
                </p>
            </section>

            <div class="flex flex-col sm:flex-row gap-4 items-stretch sm:items-center">
                <button id="loadBtn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg transition-colors shadow-lg flex items-center justify-center gap-2 focus:outline-none focus:ring-2 focus:ring-red-400">
                    <span>Load Credential Dump</span>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                    </svg>
                </button>
                <div class="flex-1 grid grid-cols-2 md:grid-cols-3 gap-3 text-sm">
                    <div class="bg-slate-900/60 border border-slate-700 rounded-lg p-3">
                        <p class="text-slate-400 text-xs uppercase tracking-widest">Status</p>
                        <p id="statusText" class="font-semibold text-white">Waiting to load credentials...</p>
                    </div>
                    <div class="bg-slate-900/60 border border-slate-700 rounded-lg p-3">
                        <p class="text-slate-400 text-xs uppercase tracking-widest">Elapsed</p>
                        <p id="timer" class="font-mono text-xl text-white">0.0s</p>
                    </div>
                    <div class="bg-slate-900/60 border border-slate-700 rounded-lg p-3">
                        <p class="text-slate-400 text-xs uppercase tracking-widest">Checks</p>
                        <p id="checkCount" class="font-mono text-xl text-white">0 / 0</p>
                    </div>
                </div>
            </div>

            <div class="flex flex-wrap gap-3 text-sm text-slate-300">
                <div class="flex items-center gap-2"><span class="text-lg" aria-hidden="true">❓</span><span>Untested</span></div>
                <div class="flex items-center gap-2"><span class="text-lg" aria-hidden="true">✅</span><span>Login succeeded</span></div>
                <div class="flex items-center gap-2"><span class="text-lg" aria-hidden="true">❌</span><span>Login failed</span></div>
            </div>

            <div class="overflow-x-auto border border-slate-700 rounded-lg bg-slate-900/60">
                <table class="min-w-full text-sm">
                    <thead class="bg-slate-800 text-slate-200">
                        <tr>
                            <th class="text-left px-4 py-3 font-semibold">Username (victim)</th>
                            <th class="text-left px-4 py-3 font-semibold">Retail</th>
                            <th class="text-left px-4 py-3 font-semibold">Social</th>
                            <th class="text-left px-4 py-3 font-semibold">Streaming</th>
                            <th class="text-left px-4 py-3 font-semibold">Email</th>
                            <th class="text-left px-4 py-3 font-semibold">Music</th>
                            <th class="text-left px-4 py-3 font-semibold">Bank</th>
                            <th class="text-left px-4 py-3 font-semibold">Gov Portal</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody" class="divide-y divide-slate-800">
                        <!-- Rows injected by script -->
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <footer class="mt-8 text-slate-500 text-sm text-center">
        <p>Generic Teaching Gem &bull; Curriculum for Wales Support</p>
    </footer>

    <script>
        const sites = [
            { key: 'retail', label: 'Retail' },
            { key: 'social', label: 'Social' },
            { key: 'streaming', label: 'Streaming' },
            { key: 'email', label: 'Email' },
            { key: 'music', label: 'Music' },
            { key: 'bank', label: 'Bank' },
            { key: 'gov', label: 'Gov Portal' }
        ];

        const credentials = [
            {
                email: 'alex.smith@example.com',
                outcomes: { retail: 'success', social: 'success', streaming: 'fail', email: 'fail', music: 'fail', bank: 'fail', gov: 'fail' }
            },
            {
                email: 'casey.lee@example.org',
                outcomes: { retail: 'fail', social: 'fail', streaming: 'success', email: 'success', music: 'fail', bank: 'fail', gov: 'fail' }
            },
            {
                email: 'morgan.taylor@example.com', // Only one success to discuss unique passwords
                outcomes: { retail: 'fail', social: 'success', streaming: 'fail', email: 'fail', music: 'fail', bank: 'fail', gov: 'fail' }
            },
            {
                email: 'jordan.rios@example.net',
                outcomes: { retail: 'success', social: 'fail', streaming: 'fail', email: 'fail', music: 'success', bank: 'fail', gov: 'fail' }
            },
            {
                email: 'samir.patel@example.org',
                outcomes: { retail: 'fail', social: 'fail', streaming: 'fail', email: 'success', music: 'fail', bank: 'success', gov: 'fail' }
            },
            {
                email: 'riley.nguyen@example.com', // reused everywhere
                outcomes: { retail: 'success', social: 'success', streaming: 'success', email: 'success', music: 'success', bank: 'success', gov: 'success' }
            },
            {
                email: 'taylor.brown@example.net', // reused everywhere
                outcomes: { retail: 'success', social: 'success', streaming: 'success', email: 'success', music: 'success', bank: 'success', gov: 'success' }
            },
            {
                email: 'jamie.clark@example.org', // reused everywhere
                outcomes: { retail: 'success', social: 'success', streaming: 'success', email: 'success', music: 'success', bank: 'success', gov: 'success' }
            },
            {
                email: 'devon.khan@example.com',
                outcomes: { retail: 'fail', social: 'success', streaming: 'fail', email: 'success', music: 'fail', bank: 'fail', gov: 'success' }
            },
            {
                email: 'avery.jones@example.com',
                outcomes: { retail: 'success', social: 'fail', streaming: 'success', email: 'fail', music: 'fail', bank: 'fail', gov: 'fail' }
            }
        ];

        let isRunning = false;
        let timerId = null;
        let startTime = 0;

        const statusText = document.getElementById('statusText');
        const timerDisplay = document.getElementById('timer');
        const checkCount = document.getElementById('checkCount');
        const loadBtn = document.getElementById('loadBtn');
        const tableBody = document.getElementById('tableBody');

        function renderTable() {
            const rows = credentials.map((cred, rowIndex) => {
                const cells = sites.map(site => `<td id="cell-${rowIndex}-${site.key}" class="px-4 py-3 font-mono text-lg text-center" aria-label="${site.label} status for ${cred.email}">❓</td>`).join('');
                return `<tr class="hover:bg-slate-800/50">
                    <td class="px-4 py-3 text-white font-semibold">${cred.email}</td>
                    ${cells}
                </tr>`;
            });
            tableBody.innerHTML = rows.join('');
        }

        function setCell(rowIndex, siteKey, outcome) {
            const cell = document.getElementById(`cell-${rowIndex}-${siteKey}`);
            if (!cell) return;
            if (outcome === 'success') {
                cell.textContent = '✅';
                cell.className = 'px-4 py-3 font-mono text-lg text-center text-emerald-300 bg-emerald-900/40';
            } else {
                cell.textContent = '❌';
                cell.className = 'px-4 py-3 font-mono text-lg text-center text-rose-300 bg-rose-900/30';
            }
        }

        function resetCells() {
            credentials.forEach((_, rowIndex) => {
                sites.forEach(site => {
                    const cell = document.getElementById(`cell-${rowIndex}-${site.key}`);
                    if (cell) {
                        cell.textContent = '❓';
                        cell.className = 'px-4 py-3 font-mono text-lg text-center text-slate-300';
                    }
                });
            });
        }

        function updateTimer() {
            const elapsedMs = performance.now() - startTime;
            timerDisplay.textContent = (elapsedMs / 1000).toFixed(1) + 's';
        }

        function startSimulation() {
            if (isRunning) return;
            isRunning = true;
            loadBtn.disabled = true;
            loadBtn.classList.add('opacity-50', 'cursor-not-allowed');
            statusText.innerHTML = '<span class="text-amber-300 animate-probe">Loading imaginary dump...</span>';
            checkCount.textContent = '0 / 0';
            timerDisplay.textContent = '0.0s';
            resetCells();

            setTimeout(() => {
                runChecks();
            }, 800); // brief "loading" pause
        }

        function runChecks() {
            startTime = performance.now();
            if (timerId) clearInterval(timerId);
            timerId = setInterval(updateTimer, 100);

            const tasks = [];
            credentials.forEach((cred, rowIndex) => {
                sites.forEach(site => {
                    const outcome = cred.outcomes[site.key] === 'success' ? 'success' : 'fail';
                    tasks.push({ rowIndex, siteKey: site.key, outcome });
                });
            });

            const total = tasks.length;
            let completed = 0;
            const targetDuration = 10000; // ~10s total
            const baseSpacing = targetDuration / total;

            tasks.forEach((task, idx) => {
                const jitter = (Math.random() * 0.3 - 0.15) * baseSpacing; // +-15%
                const delay = Math.max(0, idx * baseSpacing + jitter);
                setTimeout(() => {
                    setCell(task.rowIndex, task.siteKey, task.outcome);
                    completed += 1;
                    checkCount.textContent = `${completed} / ${total}`;
                    statusText.textContent = 'Attempting logins across sites...';

                    if (completed === total) {
                        finishRun();
                    }
                }, delay);
            });

            // Safety finish in case of timer drift
            setTimeout(finishRun, targetDuration + 500);
        }

        function finishRun() {
            if (!isRunning) return;
            isRunning = false;
            clearInterval(timerId);
            timerId = null;
            loadBtn.disabled = false;
            loadBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            statusText.innerHTML = '<span class="text-emerald-300 font-semibold">Run complete. Notice how only one victim had a single success when passwords differ.</span>';
        }

        loadBtn.addEventListener('click', startSimulation);
        renderTable();
    </script>
</body>
</html>
